<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>HSL Color Match Game</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #1e1e1e;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    margin: 0;
  }

  h1 { font-size: 2rem; text-align: center; }
  h3 { font-size: 1.3rem; text-align: center; }

  .color-box {
    width: 260px;
    height: 260px;
    max-width: 80vw;
    max-height: 80vw;
    border-radius: 16px;
    margin: 20px;
    border: 2px solid white;
  }

  .panel {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
    max-width: 400px;
    margin-top: 10px;
  }

  input[type="range"] {
    width: 100%;
    height: 16px;
    border-radius: 8px;
    appearance: none;
    background-size: 100% 100%;
    background-repeat: no-repeat;
    outline: none;
    border: 1px solid #555;
  }

  label { font-size: 1.1rem; }

  button {
    padding: 12px 20px;
    background: #4e6aff;
    border: none;
    border-radius: 10px;
    color: white;
    cursor: pointer;
    margin-top: 10px;
    width: 100%;
    max-width: 300px;
    font-size: 1.1rem;
  }

  .result-box {
    margin-top: 25px;
    font-size: 1.4rem;
    text-align: center;
    max-width: 90vw;
    word-wrap: break-word;
    display: none;
  }
</style>
</head>
<body>
<h1>HSL Color Match</h1>

<div id="targetBox" class="color-box"></div>
<div id="guessBox" class="color-box"></div>

<div class="panel">
  <label>Hue</label>
  <input id="h" type="range" min="0" max="360" value="0" />

  <label>Saturation</label>
  <input id="s" type="range" min="0" max="100" value="50" />

  <label>Lightness</label>
  <input id="l" type="range" min="0" max="100" value="50" />
</div>

<button id="submitBtn">Submit</button>
<button id="twoPlayerBtn">Two Player Mode</button>

<div id="resultBox" class="result-box"></div>

<script>
let target = { h: 0, s: 0, l: 0 };
let guess = { h: 0, s: 50, l: 50 };
let twoPlayer = false;
let p1Guess = null;

function newTarget() {
  target.h = Math.floor(Math.random() * 361);
  target.s = Math.floor(Math.random() * 101);
  target.l = Math.floor(Math.random() * 101);
  document.getElementById("targetBox").style.background = `hsl(${target.h},${target.s}%,${target.l}%)`;
}

function updateGuessColor() {
  document.getElementById("guessBox").style.background = `hsl(${guess.h},${guess.s}%,${guess.l}%)`;

  // slider gradients
  const hueGrad = `linear-gradient(to right, ${Array.from({length:361},(_,i)=>`hsl(${i},100%,50%)`).join(',')})`;
  document.getElementById("h").style.background = hueGrad;

  const sGrad = `linear-gradient(to right, hsl(${guess.h},0%,${guess.l}%), hsl(${guess.h},100%,${guess.l}%))`;
  document.getElementById("s").style.background = sGrad;

  const lGrad = `linear-gradient(to right, hsl(${guess.h},${guess.s}%,0%), hsl(${guess.h},${guess.s}%,50%), hsl(${guess.h},${guess.s}%,100%))`;
  document.getElementById("l").style.background = lGrad;
}

function resetSliders() {
  guess.h = 0;
  guess.s = 50;
  guess.l = 50;
  document.getElementById("h").value = 0;
  document.getElementById("s").value = 50;
  document.getElementById("l").value = 50;
  updateGuessColor();
}

function diff(a,b){ return Math.abs(a-b); }

function score() {
  let dh = diff(guess.h, target.h) / 360;
  let ds = diff(guess.s, target.s) / 100;
  let dl = diff(guess.l, target.l) / 100;
  let d = Math.sqrt(dh*dh + ds*ds + dl*dl);
  let pct = Math.max(0, 100 - d*100);
  return pct.toFixed(6);
}

function showResult(pct) {
  const box = document.getElementById("resultBox");
  box.style.display = "block";
  box.textContent = `Match: ${pct}% | Answer HSL(${target.h},${target.s}%,${target.l}%)`; 
}

// slider listeners
document.getElementById("h").addEventListener("input", e => { guess.h = +e.target.value; updateGuessColor(); });
document.getElementById("s").addEventListener("input", e => { guess.s = +e.target.value; updateGuessColor(); });
document.getElementById("l").addEventListener("input", e => { guess.l = +e.target.value; updateGuessColor(); });

// submit
document.getElementById("submitBtn").onclick = () => {
  if(!twoPlayer){
    let pct = score();
    showResult(pct);
    resetSliders();
  } else {
    if(p1Guess === null){
      p1Guess = { ...guess };
      resetSliders();
    } else {
      let pct = score();
      showResult(pct);
      p1Guess = null;
      newTarget();
      resetSliders();
    }
  }
};

// two player toggle
document.getElementById("twoPlayerBtn").onclick = () => {
  twoPlayer = !twoPlayer;
  p1Guess = null;
  document.getElementById("resultBox").style.display = "none";
  resetSliders();
  newTarget();
};

newTarget();
updateGuessColor();
</script>
</body>
</html>
